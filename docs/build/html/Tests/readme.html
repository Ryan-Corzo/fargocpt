
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Dust Diffusion test &#8212; FargoCPT  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../_static/doctools.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="dust-diffusion-test">
<h1>Dust Diffusion test<a class="headerlink" href="#dust-diffusion-test" title="Permalink to this heading">¶</a></h1>
<p>Charnoz et al. 2011 (DOI:10.1088/0004-637X/737/1/33) perform a dust diffusion test in a 2D disk (Sect. 3.3 Radial Diffusion in the Midplane) to test
diffusion in the midplane.</p>
<p>This is a reproduction of their test.</p>
<section id="particle-properties">
<h2>particle properties<a class="headerlink" href="#particle-properties" title="Permalink to this heading">¶</a></h2>
<p>particle size 0.1 micro m resulting in Stokes number of 1e-7 to 1e-8 between 1 and 10 au.</p>
<p>10 000 particles released at 10 au.</p>
</section>
<section id="gas-disk-model">
<h2>Gas disk model<a class="headerlink" href="#gas-disk-model" title="Permalink to this heading">¶</a></h2>
<p><span class="math notranslate nohighlight">\(\rho_g(r,z) = \rho_0 r^p \exp(-\frac{z^2}{2H(r)})\)</span>
with
<span class="math notranslate nohighlight">\(H(r) = H_0 r^\frac{q+3}{2}\)</span>
, thus <span class="math notranslate nohighlight">\(T \propto r^q\)</span>.</p>
<p>Surface density profile has an exponent of <span class="math notranslate nohighlight">\(s = p + \frac{q+3}{2}\)</span></p>
<p>Here, <span class="math notranslate nohighlight">\(p = -2.25\)</span> and <span class="math notranslate nohighlight">\(q = -0.5\)</span>, thus <span class="math notranslate nohighlight">\(s = -1\)</span>.</p>
<p>The flaring parameter is <span class="math notranslate nohighlight">\(\frac{-0.5 + 1}{2} = \frac{0.5}{2} = 0.25\)</span></p>
<p>At 1 au, <span class="math notranslate nohighlight">\(\Sigma = 200 \frac{kg}{m^2} = 20 \frac{g}{cm^2}\)</span> and <span class="math notranslate nohighlight">\(T=204 K\)</span>, resulting in <span class="math notranslate nohighlight">\(h = 0.040613\)</span> with the values below.
At 5.2 au, <span class="math notranslate nohighlight">\(\Sigma = 3.846 \frac{g}{cm^2}\)</span> and <span class="math notranslate nohighlight">\(h = 0.061328\)</span>.</p>
<p>Central star mass is 0.5 solar masses.</p>
<p>The model is based upon <span class="xref myst">Brauer et al. 2007</span>
who use a mean molecular weight of 2.3. They use the internal isothermal sound speed <span class="math notranslate nohighlight">\(c_s = \sqrt{\frac{k_B T}{\mu}}\)</span> for <span class="math notranslate nohighlight">\(H = \frac{c_s}{\Omega_K}\)</span>, thus the adiabatic exponent is <span class="math notranslate nohighlight">\(\gamma=1\)</span>.</p>
<p>Gas not moving radially, <span class="math notranslate nohighlight">\(v_r = 0\)</span>
viscosity modelled with <span class="math notranslate nohighlight">\(\alpha=0.01\)</span> which is then the only source of radial particle movement.</p>
<p>System evolved for 15 000 yr with snapshots at 2500, 5000, 10 000, and 15 000 yr.</p>
<p>For the Fargo system, turn off disk evolution to keep the background fixed.</p>
<section id="random-number-generator-for-stochastic-kicks">
<h3>Random number generator for stochastic kicks<a class="headerlink" href="#random-number-generator-for-stochastic-kicks" title="Permalink to this heading">¶</a></h3>
<p>Sampling from the standard normal distribution is done using the <a class="reference external" href="https://en.wikipedia.org/wiki/Ziggurat_algorithm">Ziggurat algorithm</a> using a <a class="reference external" href="https://github.com/snsinfu/cxx-ziggurat">C++ implementation</a>.</p>
<p>The random number generation is done using the <a class="reference external" href="http://burtleburtle.net/bob/rand/smallprng.html">JSF algorithm</a> using <a class="reference external" href="https://gist.github.com/imneme/85cff47d4bad8de6bdeb671f9c76c814">this implementation</a>.</p>
</section>
</section>
<section id="results">
<h2>Results<a class="headerlink" href="#results" title="Permalink to this heading">¶</a></h2>
<section id="initial-test">
<h3>Initial test<a class="headerlink" href="#initial-test" title="Permalink to this heading">¶</a></h3>
<p><img alt="Distribution of the dust particles at different times." src="Tests/particle_dist_diffusion_test_20-11-16.svg" /></p>
<p>To be compared to Charnoz et al. 2011.
Here, there is an error in the formula for the variance of the distibution.
There is a square root missing making the variance way too low resulting in too narrow distributions.</p>
<p>The net inward drift due to dust diffusion is clearly visible.
Its magnitude of 5 au per 10 kyr is quite large!</p>
</section>
<section id="corrected-variance-calculation-and-adaptive-time-stepping">
<h3>Corrected variance calculation and adaptive time stepping<a class="headerlink" href="#corrected-variance-calculation-and-adaptive-time-stepping" title="Permalink to this heading">¶</a></h3>
<p><img alt="Distribution of the dust particles at different times with corrected variance" src="Tests/particle_dist_diffusion_test_adaptive_newrand_20-11-20.svg" /></p>
<p>There are two kinks appearing.
This could be due to the vanishing time correlation of the random numbers <a class="reference external" href="https://academic.oup.com/mnras/article/494/4/5134/5829884">Laibe et al. 2020</a>.
But it appears at the CPU domain boundaries, so its probably a communication error.</p>
<p>Two tests for the communication error hypothesis.</p>
<ol class="arabic simple">
<li><p>Run on a single core to see whether the issue remains: out-adaptive-newrand-single.</p></li>
</ol>
<p><img alt="Particle location histogram on single core" src="Tests/particle-distribution-singlecore.svg" /></p>
<ol class="arabic simple" start="2">
<li><p>Call the move function after performing dust diffusion, at the very end of integrate: out-adaptive-newrand-movelast.</p></li>
</ol>
<p><img alt="Multicore test with move called after diffusion" src="Tests/particle-distribution-multicore-move-after-diff.svg" /></p>
<p>The particle location histogram is qualitatively similar to the Charnoz et al. 2011.
Thus, physics is modelled correctly.</p>
<p>However, something goes wrong in the multicore run at the domain boundaries.</p>
<p>The fields for the gas diffusion coefficient and the radial derivative of the density don’t differ across runs with different numbers of cores.
Thus, the problem must be related to the movement of particles across domains.</p>
<p>Removing the resizing of the particles vector in the move functions solves the issue of particles accumulating
at the boundaries.
I do not know why this happened at the moment.</p>
<p>Now, the runs with 1, 2, and 3 cores all yield the same result.</p>
<p><img alt="Comparison of the dust diffusions checks for 1-3 cores." src="Tests/particle-distribution-core-comparison.svg" /></p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">FargoCPT</a></h1>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../input.html">Input files</a></li>
<li class="toctree-l1"><a class="reference internal" href="../output.html">Output</a></li>
<li class="toctree-l1"><a class="reference internal" href="../units.html">Unit system</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Numerics/index.html">Physics and numerics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../Code%20architecture/index.html">Code architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../licence.html">Licence</a></li>
<li class="toctree-l1"><a class="reference internal" href="../acknowledgements.html">Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../citations.html">How to cite?</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Thomas Rometsch.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.1.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/Tests/readme.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>